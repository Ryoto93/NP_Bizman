# 画面設計書

## 画面一覧

1. **[画面A] トップページ（全社ダッシュボード）**
2. **[画面B] 設定・マスター管理**
3. **[画面C] 事業計画詳細画面**
4. **[画面D] コーポレート計画画面**
5. **[画面E] 顧客・案件管理（CRM）**

---

## [画面A] トップページ（全社ダッシュボード）

### 目的
会社全体の「今」の状況をスナップショットで把握し、
「事業計画（Bad/Better/Best）」と「最新見込み（Forecast）」と「実績」を
リアルタイムに比較できるようにする。

### URL
`/`

### レイアウト構成
```
┌─────────────────────────────────────────┐
│  Header (ナビゲーション)                 │
├─────────────────────────────────────────┤
│                                          │
│  【全社YTDサマリー】                     │
│  ┌─────────┬─────────┬─────────┐      │
│  │  売上   │  コスト │営業利益 │      │
│  ├─────────┼─────────┼─────────┤      │
│  │予実比較 │予実比較 │予実比較 │      │
│  │(Better) │(Better) │(Better) │      │
│  │(Bad)    │(Bad)    │(Bad)    │      │
│  │(実績)   │(実績)   │(実績)   │      │
│  └─────────┴─────────┴─────────┘      │
│                                          │
│  【グラフ表示】                          │
│  - 売上トレンド（月次、年次）            │
│  - コスト構成（パイチャート）            │
│                                          │
│  【CRMサマリー】                         │
│  ┌─────────┬─────────┬─────────┐      │
│  │総顧客数 │新規案件 │受注金額 │      │
│  │   100   │   15    │ 5,000万 │      │
│  └─────────┴─────────┴─────────┘      │
│                                          │
└─────────────────────────────────────────┘
```

### 表示項目

#### 1. 全社YTDサマリー
- **期間**: 会計年度開始月（10月）から現在月まで
- **表示項目**:
  - 売上（予算: Better/Bad、実績）
  - コスト（予算: Better/Bad、実績）
  - 営業利益（予算: Better/Bad、実績）
- **表示形式**: カード形式、数値とパーセンテージ（予実差異）

#### 2. グラフ表示
- **売上トレンドグラフ**: Recharts使用
  - 月次推移（実績 vs Better vs Bad）
  - 年次比較
- **コスト構成グラフ**: パイチャートまたは積み上げ棒グラフ

#### 3. CRMサマリー
- 総顧客数（現在の顧客数）
- 新規案件数（当月または直近3ヶ月）
- 受注金額（当月または直近3ヶ月）

### 機能要件
- 年選択ドロップダウン（会計年度）
- リアルタイムデータ取得
- データがない場合は空状態表示

---

## [画面B] 設定・マスター管理

### 目的
全社共通の情報を管理する

### URL
`/settings`

### レイアウト構成
```
┌─────────────────────────────────────────┐
│  Header                                  │
├─────────────────────────────────────────┤
│  [タブ] 事業 ｜ 商材 ｜ 案件ステータス   │
├─────────────────────────────────────────┤
│                                          │
│  【事業マスター】                        │
│  ┌──────────────────────────────────┐  │
│  │ [+ 新規作成]                      │  │
│  ├──────────────────────────────────┤  │
│  │ 事業名     │ 操作                 │  │
│  ├──────────────────────────────────┤  │
│  │ SaaS事業   │ [編集] [削除]        │  │
│  │ コンサル事業│ [編集] [削除]        │  │
│  └──────────────────────────────────┘  │
│                                          │
└─────────────────────────────────────────┘
```

### 機能

#### 1. 事業マスター管理
- **一覧表示**: テーブル形式
- **新規作成**: モーダルまたはインライン入力
- **編集**: モーダルまたはインライン編集
- **削除**: 確認ダイアログ後に削除

#### 2. 商材マスター管理
- **一覧表示**: テーブル形式（事業別フィルタ可能）
- **項目**: 商材名、紐づく事業
- **CRUD操作**: 同様

#### 3. 案件ステータス管理
- **一覧表示**: テーブル形式（ドラッグ&ドロップで順序変更可能）
- **項目**: ステータス名、表示順序
- **CRUD操作**: 同様

### UIコンポーネント
- Shadcn/uiのTable, Dialog, Formコンポーネントを使用
- React Hook Formでフォーム管理

---

## [画面C] 事業計画詳細画面

### 目的
事業ごとの計画（予算）と実績を入力する

### URL
`/business-plans/:businessId`

### レイアウト構成
```
┌─────────────────────────────────────────┐
│  Header                                  │
├─────────────────────────────────────────┤
│  [事業選択] [シナリオ選択]               │
├─────────────────────────────────────────┤
│  [タブ] KPI設定 ｜ 計画入力 ｜ 実績入力  │
├─────────────────────────────────────────┤
│                                          │
│  【KPI・売上ロジック設定】               │
│  - KPI登録フォーム                      │
│  - 売上ロジック設定フォーム              │
│                                          │
│  【KPI・売上計画入力】                   │
│  - TanStack Table（Excelライク）        │
│  - 月次入力、一括入力機能                │
│                                          │
│  【事業コスト計画入力】                   │
│  - TanStack Table（Excelライク）        │
│  - 月次入力、一括入力機能                │
│                                          │
│  【実績入力】                            │
│  - KPI実績、売上実績、コスト実績         │
│                                          │
└─────────────────────────────────────────┘
```

### 機能

#### 1. KPI・売上ロジック設定
- **KPI登録**: 
  - KPI名、単位を入力
  - 一覧表示・編集・削除
- **売上ロジック設定**:
  - 計算式を構築（例: `KPI_顧客数 * KPI_単価`）
  - ドラッグ&ドロップで式を構築するUI（オプション）
  - または、数式エディタで直接入力

#### 2. KPI・売上計画入力
- **UI要件**: TanStack Table使用
- **入力方式**:
  - セル単位で直接編集可能
  - フィルライト機能（複数セルを選択して一括入力）
  - 成長率・増減適用機能
    - 選択範囲の最初の値を基準に、指定した成長率または増減額を適用
- **表示形式**: 
  - 行: KPI項目、売上項目
  - 列: 月（1-12月）
  - 合計行・合計列を表示

#### 3. 事業コスト計画入力
- **コスト項目登録**: コスト項目名を登録
- **入力UI**: KPI計画と同様のTanStack Table
- **一括入力機能**: 同様

#### 4. 実績入力
- **KPI実績**: 月次で実績値を入力
- **売上実績**: 
  - CRM連携（自動）: 案件ステータスが「受注」になったら自動連携
  - 手動入力: 直接入力も可能
  - メモ欄: 自動で「[顧客名] / [案件名]」が入る
- **コスト実績**: 月次で実績値を入力、メモ欄あり

### UIコンポーネント
- TanStack Table (v8) でExcelライクな編集可能テーブル
- フィルライト機能の実装
- 成長率・増減適用のUI（ツールバーまたはコンテキストメニュー）

---

## [画面D] コーポレート計画画面

### 目的
全社共通コスト、特に「人」に関する計画と実績を入力する

### URL
`/corporate-plan`

### レイアウト構成
```
┌─────────────────────────────────────────┐
│  Header                                  │
├─────────────────────────────────────────┤
│  [シナリオ選択]                          │
├─────────────────────────────────────────┤
│  [タブ] 人員計画 ｜ コスト計画 ｜ 実績   │
├─────────────────────────────────────────┤
│                                          │
│  【人員計画（By Name）】                  │
│  - TanStack Table                       │
│  - 氏名、契約形態、単価、期間入力        │
│                                          │
│  【全社コスト計画】                      │
│  - 自動連携: 人件費、法定福利費、委託費 │
│  - 手動入力: 家賃、通信費など            │
│  - TanStack Table（一括入力対応）       │
│                                          │
│  【実績入力】                            │
│  - 全社コスト実績の月次入力              │
│                                          │
└─────────────────────────────────────────┘
```

### 機能

#### 1. 人員計画（By Name）
- **入力項目**:
  - 氏名（TBD可）
  - 契約形態（選択肢: 正社員、契約社員、業務委託等）
  - 単価（月額）
  - 在籍期間（開始月・年、終了月・年）
  - 担当事業（選択または未割当）
- **UI**: TanStack Tableで一覧表示・編集

#### 2. 全社コスト計画
- **自動連携項目**:
  - 人件費: 人員計画から自動計算
  - 法定福利費: 人件費から自動計算（比率設定可能）
  - 業務委託費: 人員計画の業務委託契約から自動計算
- **手動入力項目**:
  - 家賃、通信費など、項目を登録して月次入力
- **UI**: TanStack Tableで一括入力対応

#### 3. 実績入力
- 全社コストの月次実績入力
- メモ欄あり

---

## [画面E] 顧客・案件管理（CRM）

### 目的
顧客情報と商談進捗を一元管理し、売上実績の基盤とする

### URL
`/crm`

### レイアウト構成
```
┌─────────────────────────────────────────┐
│  Header                                  │
├─────────────────────────────────────────┤
│  [タブ] 顧客一覧 ｜ 案件管理（カンバン） │
├─────────────────────────────────────────┤
│                                          │
│  【顧客一覧】                            │
│  - テーブル形式                          │
│  - 検索・フィルタ機能                    │
│                                          │
│  【案件管理（カンバン）】                │
│  ┌──────┬──────┬──────┬──────┐        │
│  │ リード│商談中│ 受注 │ 失注 │        │
│  ├──────┼──────┼──────┼──────┤        │
│  │ [案件]│[案件]│[案件]│[案件]│        │
│  │ [案件]│[案件]│[案件]│      │        │
│  └──────┴──────┴──────┴──────┘        │
│                                          │
└─────────────────────────────────────────┘
```

### 機能

#### 1. 顧客マスター管理
- **一覧表示**: テーブル形式
- **検索・フィルタ**: 顧客名、担当者名で検索
- **CRUD操作**: 顧客情報の作成・編集・削除
- **項目**: 顧客名、担当者、連絡先（email, phone）、住所

#### 2. 案件（商談）管理
- **カンバンUI**: 
  - ステータスごとのカラム表示
  - ドラッグ&ドロップでステータス変更
- **案件カード**: 
  - 案件名、顧客名、商材、受注予定月・額、担当者
  - クリックで詳細モーダル表示
- **詳細モーダル**:
  - 全項目の編集
  - 活動履歴の追加・編集
- **案件作成**: モーダルまたはフォーム画面

#### 3. 売上実績への自動連携
- **自動連携ロジック**:
  - 案件ステータスが「受注」になったら自動実行
  - 対象事業計画の売上実績に登録
  - 受注予定月・額を元に登録
  - メモ欄に「[顧客名] / [案件名]」を自動記入

### UIコンポーネント
- カンバンUI: カスタムコンポーネント（react-beautiful-dnd または dnd-kit使用）
- モーダル: Shadcn/uiのDialog
- フォーム: React Hook Form

---

## 共通UIコンポーネント

### ナビゲーション
- サイドバーまたはヘッダーに全画面へのリンク
- 現在のページをハイライト

### ローディング状態
- データ取得中のスケルトン表示

### エラー処理
- エラーメッセージの表示
- リトライ機能

### レスポンシブ対応
- モバイル表示にも対応（特にダッシュボードとCRM）


