# 認証機能動作確認手順

## 概要

このドキュメントでは、実装した認証機能の動作確認手順を説明します。

## 前提条件

- Supabaseプロジェクトが作成済みであること
- 環境変数（`.env.local`）が正しく設定されていること
- 開発サーバーが起動可能であること

## 確認手順

### ステップ1: 開発サーバーの起動確認

1. ターミナルでプロジェクトルートに移動：
```bash
cd C:\Users\ryout\Documents\NP_BusinessManagement
```

2. 開発サーバーを起動：
```bash
npm run dev
```

3. 以下のメッセージが表示されることを確認：
```
✓ Ready in [時間]
○ Local:        http://localhost:3000
```

### ステップ2: Supabaseでテストユーザーの作成

1. [Supabase Dashboard](https://app.supabase.com) にアクセス
2. プロジェクトを選択（`fgnbfczmvsauzmzjuhpl`）
3. 左側メニューから **「Authentication」** をクリック
4. **「Users」** タブを選択
5. **「Add user」** ボタンをクリック
6. **「Create new user」** を選択
7. 以下の情報を入力：
   - **Email**: `test@example.com`（任意のメールアドレス）
   - **Password**: `test123456`（任意のパスワード、8文字以上）
   - **Auto Confirm User**: ✅ チェックを入れる（自動確認）
8. **「Create user」** をクリック

**注意**: 作成したメールアドレスとパスワードはメモしておいてください。

### ステップ3: ブラウザでアクセス

1. ブラウザで `http://localhost:3000` にアクセス
2. **期待される動作**:
   - 自動的に `/login` ページにリダイレクトされる
   - ログイン画面が表示される

### ステップ4: ログイン機能のテスト

1. **ログイン画面が表示されることを確認**:
   - オレンジ色のNPロゴが表示される
   - 「ログイン」というタイトルが表示される
   - メールアドレスとパスワードの入力欄がある
   - 「ログイン」ボタンがある

2. **無効な認証情報でログインを試行**:
   - メールアドレス: `wrong@example.com`
   - パスワード: `wrongpassword`
   - 「ログイン」ボタンをクリック
   - **期待される動作**:
     - エラーメッセージが赤色で表示される
     - 「Invalid login credentials」などのエラーが表示される

3. **正しい認証情報でログイン**:
   - メールアドレス: `test@example.com`（ステップ2で作成したメールアドレス）
   - パスワード: `test123456`（ステップ2で作成したパスワード）
   - 「ログイン」ボタンをクリック
   - **期待される動作**:
     - ログインが成功する
     - 自動的にダッシュボード（`/`）にリダイレクトされる
     - ヘッダーにナビゲーションメニューが表示される
     - ヘッダー右上にユーザーメニュー（アバター）が表示される

### ステップ5: 認証状態の確認

1. **ダッシュボードページの確認**:
   - ヘッダーが表示されている
   - ダッシュボードのカードが表示されている
   - フッターが表示されている

2. **ユーザーメニューの確認**:
   - ヘッダー右上のアバターをクリック
   - **期待される動作**:
     - ドロップダウンメニューが開く
     - メールアドレスが表示される
     - 「ログアウト」メニュー項目が表示される

### ステップ6: ログアウト機能のテスト

1. ユーザーメニューから **「ログアウト」** をクリック
2. **期待される動作**:
   - ログアウトが成功する
   - 自動的に `/login` ページにリダイレクトされる
   - ヘッダーとフッターが表示されない（ログイン画面のみ）

### ステップ7: 認証保護の確認

1. **ログアウト状態で保護ページにアクセス**:
   - ブラウザのアドレスバーに `http://localhost:3000` と入力
   - Enterキーを押す
   - **期待される動作**:
     - 自動的に `/login` ページにリダイレクトされる
     - URLに `?redirect=/` が追加される

2. **ログイン後のリダイレクト確認**:
   - ログイン画面で正しい認証情報を入力
   - ログイン成功後、元々アクセスしようとしていたページ（`/`）にリダイレクトされることを確認

3. **認証済みユーザーがログイン画面にアクセス**:
   - ログイン済みの状態で `http://localhost:3000/login` にアクセス
   - **期待される動作**:
     - 自動的にダッシュボード（`/`）にリダイレクトされる

## 確認項目チェックリスト

- [ ] 開発サーバーが正常に起動する
- [ ] Supabaseでテストユーザーを作成できた
- [ ] 未認証時に `/login` にリダイレクトされる
- [ ] ログイン画面が正しく表示される
- [ ] 無効な認証情報でエラーが表示される
- [ ] 正しい認証情報でログインできる
- [ ] ログイン後にダッシュボードにリダイレクトされる
- [ ] ヘッダーにユーザーメニューが表示される
- [ ] ユーザーメニューからログアウトできる
- [ ] ログアウト後にログイン画面にリダイレクトされる
- [ ] 保護ページへの未認証アクセスがリダイレクトされる
- [ ] 認証済みユーザーがログイン画面にアクセスできない

## トラブルシューティング

### ログインできない場合

1. **環境変数の確認**:
   - `.env.local` ファイルが存在するか確認
   - `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が正しく設定されているか確認

2. **Supabaseプロジェクトの確認**:
   - Supabaseダッシュボードでプロジェクトがアクティブであることを確認
   - Authentication → Users でユーザーが作成されているか確認

3. **ブラウザのコンソールを確認**:
   - F12キーを押して開発者ツールを開く
   - 「Console」タブでエラーメッセージを確認

### リダイレクトループが発生する場合

1. **環境変数の確認**:
   - `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が正しく設定されているか確認
   - 値が空文字列や `undefined` になっていないか確認

2. **開発サーバーの再起動**:
   - 開発サーバーを停止（Ctrl+C）
   - `.env.local` を確認
   - 再度 `npm run dev` で起動

### ユーザーメニューが表示されない場合

1. **ブラウザのキャッシュをクリア**:
   - Ctrl+Shift+Delete でキャッシュをクリア
   - またはブラウザを再起動

2. **開発サーバーの再起動**:
   - 開発サーバーを停止して再起動

## 次のステップ

認証機能の動作確認が完了したら：

1. **Row Level Security (RLS) ポリシーの設定**
   - SupabaseでRLSポリシーを設定して、ユーザーごとにデータアクセスを制限

2. **ユーザープロフィール管理機能の実装**
   - プロフィール編集画面の作成
   - アバター画像のアップロード機能

3. **パスワードリセット機能の実装**
   - パスワード忘れ時のリセット機能

